# 快速入门: 编写你的第一个 Django 应用

## 参考资料

建议先看 [官方文档]快速入门: 编写你的第一个 Django 应用

熟悉django开发基本步骤

再查看 Django官方文档(完整版)

[Django官方文档(完整版)](https://docs.djangoproject.com/zh-hans/3.1/contents/)

[[官方文档]快速入门: 编写你的第一个 Django 应用](https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial01/)

[Django视频](https://www.bilibili.com/video/BV1Tx411d7E7)

[django框架_视频文档.docx](https://github.com/chengziqaq/Note/tree/master/docs/cs/backend/Django/django框架_视频文档.docx)

[之前的学习笔记](https://github.com/chengziqaq/Django)

## Django介绍

[维基百科介绍](https://zh.wikipedia.org/wiki/Django)

[扩展阅读: Web应用框架](https://zh.wikipedia.org/wiki/Web%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6)

## 项目规划

- 项目规划

- 测试数据

## 编写你的第一个 Django 应用，第 5 部分: 测试

https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial05/#writing-our-first-test

- shell里测试
- 编写测试代码

### 如果你对测试有个整体规划，那么它们就几乎不会变得混乱。下面有几条好的建议：

- 对于每个模型和视图都建立单独的 `TestClass`
- 每个测试方法只测试一个功能
- 给每个测试方法起个能描述其功能的名字

## 注释

三个双引号

## 编写你的第一个 Django 应用，第 6 部分: 静态文件

```css
警告
The {% static %} template tag is not available for use in static files which aren't generated by Django, like your stylesheet. You should always use relative paths to link your static files between each other, because then you can change STATIC_URL (used by the static template tag to generate its URLs) without having to modify a bunch of paths in your static files as well.
```

上面警告的一个例子:

- 例子中的css中引入背景图片需要用相对路径, 这个背景图片不是由Django生成,不能使用{% static %}引用

##  编写你的第一个 Django 应用，第 7 部分: 自定义后台

## 进阶指南：如何编写可重用程序

# 详细文档学习

## 开始项目

###  新建项目和app

```shell
django-admin startproject 项目名称
```

这里我的项目名称为learning

```shell
python manage.py startapp app名称
```

这里我的app名称为app1

### 配置mysql数据库

- 安装mysql

- 创建数据库(django不会自动创建数据库 需要手动创建)

  我创建的 数据库名字 为django_learning, 后面要填入到配置文件中

- 安装pymysql

  ```shell
  python3 -m pip install PyMySQL
  ```
  - 由于django官方貌似不支持pymysql,但是有其他办法用pymysql(且mysqldb安装失败)

  - setting.py中

    来源: [How to use PyMySQL with Django](https://adamj.eu/tech/2020/02/04/how-to-use-pymysql-with-django/)

    ```python
    import pymysql
    
    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.mysql',
            'NAME': '数据库名字',
            'USER': '数据库用户名',
            'PASSWORD': '数据库密码',
            'HOST': 'mysql数据库服务器ip地址',
            'PORT': 'mysql端口',
        }
    }
    
    # Fake PyMySQL's version and install as MySQLdb
    # https://adamj.eu/tech/2020/02/04/how-to-use-pymysql-with-django/
    pymysql.version_info = (1, 4, 2, "final", 0)
    pymysql.install_as_MySQLdb()
    ```

  - 测试

    ```python
    进入django命令行: 
    python manage.py shell
    运行下面两个命令: 
    import MySQLdb
    MySQLdb
    
    输出信息: <module 'pymysql' from '/.../site-packages/pymysql/__init__.py'>
    ```

- 注册项目到Django setting文件中.

- 增加下面这句到 INSTALLED_APPS, 其中app1替换为自己的app名字,

  也就是 

  python manage.py startapp app名称 这里面的app名称

  ```python
  'app1.apps.App1Config',
  ```

  修改后看起来是这样的

  ```tex
  INSTALLED_APPS = [
      'django.contrib.admin',
      'django.contrib.auth',
      'django.contrib.contenttypes',
      'django.contrib.sessions',
      'django.contrib.messages',
      'django.contrib.staticfiles',
      'app1.apps.App1Config',
  ]
  ```

- 编写app1/models.py文件测试

  这是Django官方教程里的一个例子

  ```python
  from django.db import models
  
  
  class Question(models.Model):
      question_text = models.CharField(max_length=200)
      pub_date = models.DateTimeField('date published')
  
  
  class Choice(models.Model):
      question = models.ForeignKey(Question, on_delete=models.CASCADE)
      choice_text = models.CharField(max_length=200)
      votes = models.IntegerField(default=0)
  ```

  

- 命令行操作, 执行数据库相关的操作:  

   必须先执行第一句,生成数据库迁移文件

  第二句是应用到数据库.

  第一句只是在本地生成数据库相关的py文件

  第二句才操作数据库

  - 第一句

  ```python
  python manage.py makemigrations
  ```

  - 第二句

    ```python
    python manage.py migrate
    ```

    

  - 执行后可以查看 app1/migrations/0001_initial.py这个文件, 如下

  ```python
  # Generated by Django 3.1 on 2020-08-07 13:42
  
  from django.db import migrations, models
  import django.db.models.deletion
  
  
  class Migration(migrations.Migration):
  
      initial = True
  
      dependencies = [
      ]
  
      operations = [
          migrations.CreateModel(
              name='Question',
              fields=[
                  ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                  ('question_text', models.CharField(max_length=200)),
                  ('pub_date', models.DateTimeField(verbose_name='date published')),
              ],
          ),
          migrations.CreateModel(
              name='Choice',
              fields=[
                  ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                  ('choice_text', models.CharField(max_length=200)),
                  ('votes', models.IntegerField(default=0)),
                  ('question', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='app1.question')),
              ],
          ),
      ]
      
  ```

  - 可以对照数据库查看表结构, 我用的sequel pro 2(mac软件)

    可以看到有 app1_choice 和 app1_question 还有其他django系统用到的数据库. 可以看出是 models.py中的 应用名称_类名

    变量名为数据表里的列名, 所以很直观models.py是定义数据库相关的

    进一步可以查看表结构

接下来就可以看模型和数据库试试

- 所需python包记录

  ```python
  pip freeze > requirements.txt
  ```

## 模型和数据库

### 模型

- 一般来说，每一个模型都映射一张数据库表。

- 每个模型都是一个 Python 的类，这些类继承 [`django.db.models.Model`](https://docs.djangoproject.com/zh-hans/3.1/ref/models/instances/#django.db.models.Model)
- 模型类的每个属性都相当于一个数据库的字段。
- 利用这些，Django 提供了一个自动生成访问数据库的 API；请参阅 [执行查询](https://docs.djangoproject.com/zh-hans/3.1/topics/db/queries/)。

- 一个 `id` 字段会被自动添加，但是这种行为可以被改写。请参阅 [自动设置主键](https://docs.djangoproject.com/zh-hans/3.1/topics/db/models/#automatic-primary-key-fields)。

- 当你向 [`INSTALLED_APPS`](https://docs.djangoproject.com/zh-hans/3.1/ref/settings/#std:setting-INSTALLED_APPS) 添加新的应用的时候，请务必运行 [`manage.py migrate`](https://docs.djangoproject.com/zh-hans/3.1/ref/django-admin/#django-admin-migrate)，此外你也可以先使用以下命令进行迁移 [`manage.py makemigrations`](https://docs.djangoproject.com/zh-hans/3.1/ref/django-admin/#django-admin-makemigrations)。

