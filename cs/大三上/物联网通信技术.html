<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>物联网通信技术 | MarkDown Notes</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="&#39;stylesheet" href="/Note/styles/website.css">
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/Note/assets/css/0.styles.c3b168f2.css" as="style"><link rel="preload" href="/Note/assets/js/app.3401943d.js" as="script"><link rel="preload" href="/Note/assets/js/4.23a40e1e.js" as="script"><link rel="preload" href="/Note/assets/js/26.bee200f9.js" as="script"><link rel="preload" href="/Note/assets/js/27.fe55bec1.js" as="script"><link rel="prefetch" href="/Note/assets/js/10.e1b9ec7f.js"><link rel="prefetch" href="/Note/assets/js/11.eb9277a8.js"><link rel="prefetch" href="/Note/assets/js/12.cfdeef76.js"><link rel="prefetch" href="/Note/assets/js/13.72c69cfa.js"><link rel="prefetch" href="/Note/assets/js/14.723fcbaa.js"><link rel="prefetch" href="/Note/assets/js/15.8a826c9f.js"><link rel="prefetch" href="/Note/assets/js/16.63db760f.js"><link rel="prefetch" href="/Note/assets/js/17.b54cf4e6.js"><link rel="prefetch" href="/Note/assets/js/18.a2cc9025.js"><link rel="prefetch" href="/Note/assets/js/19.51b8b4a8.js"><link rel="prefetch" href="/Note/assets/js/2.705bafb0.js"><link rel="prefetch" href="/Note/assets/js/20.6f1faeaa.js"><link rel="prefetch" href="/Note/assets/js/21.e482b227.js"><link rel="prefetch" href="/Note/assets/js/22.f0646757.js"><link rel="prefetch" href="/Note/assets/js/23.078a0f3f.js"><link rel="prefetch" href="/Note/assets/js/24.d4925114.js"><link rel="prefetch" href="/Note/assets/js/25.7dae1086.js"><link rel="prefetch" href="/Note/assets/js/28.a50e7e09.js"><link rel="prefetch" href="/Note/assets/js/29.f174e155.js"><link rel="prefetch" href="/Note/assets/js/3.a3969362.js"><link rel="prefetch" href="/Note/assets/js/30.04a0bd6a.js"><link rel="prefetch" href="/Note/assets/js/31.9f07941f.js"><link rel="prefetch" href="/Note/assets/js/32.0cf8fec9.js"><link rel="prefetch" href="/Note/assets/js/33.1fa337a6.js"><link rel="prefetch" href="/Note/assets/js/34.124327d9.js"><link rel="prefetch" href="/Note/assets/js/35.2137b847.js"><link rel="prefetch" href="/Note/assets/js/36.4d146863.js"><link rel="prefetch" href="/Note/assets/js/37.b8cffdbe.js"><link rel="prefetch" href="/Note/assets/js/38.23a96eb5.js"><link rel="prefetch" href="/Note/assets/js/39.4f8445f4.js"><link rel="prefetch" href="/Note/assets/js/40.98c9710f.js"><link rel="prefetch" href="/Note/assets/js/41.dd2311d2.js"><link rel="prefetch" href="/Note/assets/js/42.ea0dac99.js"><link rel="prefetch" href="/Note/assets/js/43.bc42f537.js"><link rel="prefetch" href="/Note/assets/js/44.9b3882ae.js"><link rel="prefetch" href="/Note/assets/js/45.2cd2af37.js"><link rel="prefetch" href="/Note/assets/js/46.28170d79.js"><link rel="prefetch" href="/Note/assets/js/47.1663d548.js"><link rel="prefetch" href="/Note/assets/js/48.45b6c04e.js"><link rel="prefetch" href="/Note/assets/js/49.c63ba556.js"><link rel="prefetch" href="/Note/assets/js/5.4dd1d05b.js"><link rel="prefetch" href="/Note/assets/js/50.deb8cb91.js"><link rel="prefetch" href="/Note/assets/js/51.c5603559.js"><link rel="prefetch" href="/Note/assets/js/52.5011b340.js"><link rel="prefetch" href="/Note/assets/js/53.ac1427a9.js"><link rel="prefetch" href="/Note/assets/js/54.0a2dde53.js"><link rel="prefetch" href="/Note/assets/js/55.e503c7d3.js"><link rel="prefetch" href="/Note/assets/js/56.9d45122f.js"><link rel="prefetch" href="/Note/assets/js/57.a3de63db.js"><link rel="prefetch" href="/Note/assets/js/58.b7216bcb.js"><link rel="prefetch" href="/Note/assets/js/59.4fdeb9a7.js"><link rel="prefetch" href="/Note/assets/js/6.f8dd4cf2.js"><link rel="prefetch" href="/Note/assets/js/60.3691eb89.js"><link rel="prefetch" href="/Note/assets/js/61.9afb4be9.js"><link rel="prefetch" href="/Note/assets/js/62.b4f07ace.js"><link rel="prefetch" href="/Note/assets/js/63.63d510b6.js"><link rel="prefetch" href="/Note/assets/js/64.4fd28511.js"><link rel="prefetch" href="/Note/assets/js/65.24c89a86.js"><link rel="prefetch" href="/Note/assets/js/66.aaea38e3.js"><link rel="prefetch" href="/Note/assets/js/7.77c1ea1b.js"><link rel="prefetch" href="/Note/assets/js/8.72c9d281.js"><link rel="prefetch" href="/Note/assets/js/9.5f3b8012.js">
    <link rel="stylesheet" href="/Note/assets/css/0.styles.c3b168f2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Note/" class="home-link router-link-active"><!----> <span class="site-name">MarkDown Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Note/Navigate.html" class="nav-link">
  导航页
</a></div><div class="nav-item"><a href="/Note/exam/examtime.html" class="nav-link">
  课程与考试
</a></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span>Switch theme</span></a></div> <a href="https://github.com/DayoWong0/Note" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Note/Navigate.html" class="nav-link">
  导航页
</a></div><div class="nav-item"><a href="/Note/exam/examtime.html" class="nav-link">
  课程与考试
</a></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span>Switch theme</span></a></div> <a href="https://github.com/DayoWong0/Note" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/Note/Navigate.html" class="sidebar-link">导航</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>后端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机专业课</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>大三上</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Note/cs/大三上/无线传感器网络.html" class="sidebar-link">无线传感器网络</a></li><li><a href="/Note/cs/大三上/工程概论.html" class="sidebar-link">工程概论</a></li><li><a href="/Note/cs/大三上/工程概论习题和答案.html" class="sidebar-link">工程概论习题和答案</a></li><li><a href="/Note/cs/大三上/物联网通信技术.html" class="active sidebar-link">物联网通信技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Note/cs/大三上/物联网通信技术.html#通信基础" class="sidebar-link">通信基础</a></li><li class="sidebar-sub-header"><a href="/Note/cs/大三上/物联网通信技术.html#_2-zigbee" class="sidebar-link">2. ZigBee</a></li><li class="sidebar-sub-header"><a href="/Note/cs/大三上/物联网通信技术.html#zigbee" class="sidebar-link">ZigBee</a></li><li class="sidebar-sub-header"><a href="/Note/cs/大三上/物联网通信技术.html#课程设计" class="sidebar-link">课程设计</a></li><li class="sidebar-sub-header"><a href="/Note/cs/大三上/物联网通信技术.html#课程设计-4g-短信通知-温度报警系统" class="sidebar-link">课程设计 4G 短信通知 温度报警系统</a></li><li class="sidebar-sub-header"><a href="/Note/cs/大三上/物联网通信技术.html#蓝牙" class="sidebar-link">蓝牙</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>桌面应用开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Android</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>学习方法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络安全</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-succinct-content content__default"><h1 id="物联网通信技术"><a href="#物联网通信技术" class="header-anchor">#</a> 物联网通信技术</h1> <h2 id="通信基础"><a href="#通信基础" class="header-anchor">#</a> 通信基础</h2> <h3 id="数字信号的傅里叶分析"><a href="#数字信号的傅里叶分析" class="header-anchor">#</a> 数字信号的傅里叶分析</h3> <p>作用: 将需要研究的信号变成多个正余弦函数, 便于研究</p> <p>ppt 55 页</p> <h3 id="信道"><a href="#信道" class="header-anchor">#</a> 信道</h3> <h4 id="有线信道"><a href="#有线信道" class="header-anchor">#</a> 有线信道</h4> <p>包括明线、对称电缆、同轴电缆及光缆等。</p> <h4 id="无线信道"><a href="#无线信道" class="header-anchor">#</a> 无线信道</h4> <p>包括地波传播、天波传输、视线传播。</p> <h2 id="_2-zigbee"><a href="#_2-zigbee" class="header-anchor">#</a> 2. ZigBee</h2> <p>学习 WLAN Bluetooth ZigBee 移动通信网络 四种通信技术</p> <h3 id="_2-1-名字来源"><a href="#_2-1-名字来源" class="header-anchor">#</a> 2.1 名字来源</h3> <p>蜜蜂通过舞蹈 Zig-Zag 来传递发现的食物信息。</p> <p>IEEE 成立 <strong>802.15.4</strong> 工作组。负责低速个域网（LR-WPAN）。</p> <p>802.15.4：低速个域网。ZigBee。</p> <p>【频率】：中速个域网。蓝牙</p> <p>802.15.3：高速个域网</p> <h3 id="_2-2-应用"><a href="#_2-2-应用" class="header-anchor">#</a> 2.2 应用</h3> <h4 id="_2-2-1-智能家居"><a href="#_2-2-1-智能家居" class="header-anchor">#</a> 2.2.1 智能家居</h4> <p>网关：协议转换作用。比如 ZigBee 和 WLAN 协议沟通就需要用到网关。</p> <p>CC2530 是芯片</p> <h4 id="_2-2-2-工业领域"><a href="#_2-2-2-工业领域" class="header-anchor">#</a> 2.2.2 工业领域</h4> <p>通过 ZigBee 网络控制各种工业设备</p> <h4 id="_2-2-3-实例"><a href="#_2-2-3-实例" class="header-anchor">#</a> 2.2.3 实例</h4> <ul><li><p>电力高压线监控</p></li> <li><p>葡萄园监测土壤信息</p></li> <li><p>道路结冰监测</p></li> <li><p>物流系统</p></li> <li><p>列车铁轨监测</p></li></ul> <h3 id="_2-3-zigbee-技术特点"><a href="#_2-3-zigbee-技术特点" class="header-anchor">#</a> 2.3 ZigBee 技术特点</h3> <p>P 58</p> <ul><li><p>低功耗</p> <p>收发信息功率低，为 1mW</p> <p>采用休眠模式</p></li> <li><p>低成本</p> <ul><li>ZigBee 协议免专利费</li> <li>硬件成本低，十几块一个。</li></ul></li> <li><p>网络容量大</p> <p>可连接 65535（ 2 的 16 次方 ）到 2 的 64 次方个设备。</p></li> <li><p>时延短</p> <p>响应速度快。</p> <p>搜索时延：30ms</p> <p>休眠激活时延：15ms</p> <p>活动设备信道接入时延：15ms</p></li> <li><p>具有良好的拓扑结构、自愈能力</p></li> <li><p>数据安全</p> <p>采用了 AES-128 加密算法</p></li> <li><p>可靠</p> <p>MAC 层采用了碰撞避免机制</p></li></ul> <h4 id="蓝牙补充"><a href="#蓝牙补充" class="header-anchor">#</a> 蓝牙补充</h4> <ul><li><p>普通蓝牙</p> <p>单点覆盖范围 10 M</p></li> <li><p>低功耗蓝牙（ BLE ）</p></li> <li><p>双模蓝牙：可切换为普通蓝牙模式又可以切换为低功耗蓝牙模式</p></li></ul> <h3 id="_2-4-zigbee-协议栈"><a href="#_2-4-zigbee-协议栈" class="header-anchor">#</a> 2.4  ZigBee 协议栈</h3> <ul><li>物理层</li> <li>数据链路层</li> <li>...</li></ul> <h3 id="_2-5-zigbee-拓扑结构"><a href="#_2-5-zigbee-拓扑结构" class="header-anchor">#</a> 2.5 ZigBee 拓扑结构</h3> <ul><li><p>星型结构</p> <p>通过中心节点交换通信</p></li> <li><p>树状（ 簇-树 状 ）</p> <p>只能和父节点或者子节点通信</p></li> <li><p>网状结构</p> <p>在树状基础上实现的，路由协议最复杂</p></li></ul> <h3 id="_2-6-协议层"><a href="#_2-6-协议层" class="header-anchor">#</a> 2.6 协议层</h3> <h4 id="_2-6-1-物理层"><a href="#_2-6-1-物理层" class="header-anchor">#</a> 2.6.1 物理层</h4> <p>cc2530 用的 2.4 G，有 16 个信道</p> <h5 id="_2-6-1-1-直接序列扩频-dsss"><a href="#_2-6-1-1-直接序列扩频-dsss" class="header-anchor">#</a> 2.6.1.1 直接序列扩频 （ DSSS ）</h5> <p>调制方式</p> <p>O-QPSK</p> <h2 id="zigbee"><a href="#zigbee" class="header-anchor">#</a> ZigBee</h2> <p><a href="https://github.com/fukangwei/New_Blog_MarkDown/blob/cf21b5649079c136aba446cfe13715d0ab6712b4/CC2530%E5%92%8Czigbee%E7%AC%94%E8%AE%B0/%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1%E5%AE%9E%E9%AA%8C%E6%B5%81%E7%A8%8B.md" target="_blank" rel="noopener noreferrer">New_Blog_MarkDown/串口通信实验流程.md at cf21b5649079c136aba446cfe13715d0ab6712b4 · fukangwei/New_Blog_MarkDown<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/fukangwei/New_Blog_MarkDown/tree/master/CC2530%E5%92%8Czigbee%E7%AC%94%E8%AE%B0" target="_blank" rel="noopener noreferrer">New_Blog_MarkDown/CC2530和zigbee笔记 at master · fukangwei/New_Blog_MarkDown<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="课程设计"><a href="#课程设计" class="header-anchor">#</a> 课程设计</h2> <p>下周（12周）两次课都是考试。实验报告 9 1 1。做一个小项目。最后两次 1 以个人为单位。</p> <p>十三周课程设计：在小项目的基础上扩展，可以配合安卓 JavaWeb 做一个大的项目出来。</p> <p>可以直接做 ZigBee 无线传感器网络 书籍上的例子 或者将例子作为你的项目的一部分。</p> <p><img src="/Note/assets/img/image-20201113092553303.8082b958.png" alt="image-20201113092553303"></p> <ul><li>P180 7.1 或 P199 7.3</li></ul> <h2 id="课程设计-4g-短信通知-温度报警系统"><a href="#课程设计-4g-短信通知-温度报警系统" class="header-anchor">#</a> 课程设计 4G 短信通知 温度报警系统</h2> <blockquote><p>911中的第一个1 十四周 周日截止。最后一个课程设计最后一个1，最迟十七周</p></blockquote> <p>思路：开发版连上两个硬件，获取温度，温度超过上限，4G 模块发送短信。</p> <p>可以改 WIFI 模块发送 邮件 Telegram QQ 微信等消息推送。</p> <p>重难点在于编写代码部分。</p> <p>参考</p> <ul><li><p>C:\Users\16903\Desktop\物联网通信技术\传感器实验\实验9 温湿度传感器实验-V20160421 的代码</p> <p>将串口助手发送的指令转到代码里</p></li> <li><p>C:\Users\16903\Desktop\物联网通信技术\10-11 4G短信-电话</p></li> <li><p>此开发板的操作指南</p> <p>ftp 上 cc2530串口等资源</p></li> <li><p>C:\Users\16903\Desktop\物联网通信技术\物联网通信技术课程设计</p> <p>别人的实验报告</p></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;STC12C5A60S2.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;intrins.h&gt;</span></span>
<span class="token comment">/**********************************************************/</span>
<span class="token comment">//晶振频率：11.0592MHz</span>
<span class="token comment">//文件名  ：Main.c</span>
<span class="token comment">//功能说明：温湿度传感器AM2321读取实验</span>
<span class="token comment">//制作    ：www.frotech.com</span>
<span class="token comment">//技术支持：020-22883196 QQ:</span>
<span class="token comment">//变更记录: 2013.05.02</span>
<span class="token comment">//变更内容: 新建造</span>
<span class="token comment">/**********************************************************/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	 <span class="token expression">BUF_LENTH	<span class="token number">128</span>		</span><span class="token comment">//定义串口接收缓冲长度</span></span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> 	uart1_wr<span class="token punctuation">;</span>		<span class="token comment">//写指针</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> 	uart1_rd<span class="token punctuation">;</span>		<span class="token comment">//读指针</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> 	xdata RX0_Buffer<span class="token punctuation">[</span>BUF_LENTH<span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//定义串口接收缓冲</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> flag<span class="token punctuation">;</span>	<span class="token comment">//定义串口中断接收标号，即当其为1时表示串口介绍到数据。</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>    <span class="token comment">//定义普通变量。</span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Sensor_Data<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//定义温湿度传感器数据存放区。</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Sensor_Check<span class="token punctuation">;</span>		  <span class="token comment">//温湿度传感器校验和，判断读取的温湿度数据是否正确。</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Sensor_AnswerFlag<span class="token punctuation">;</span>  <span class="token comment">//温湿度传感器收到起始标志位</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Sensor_ErrorFlag<span class="token punctuation">;</span>   <span class="token comment">//读取传感器错误标志</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Ascii_buffer<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token string">'6'</span><span class="token punctuation">,</span><span class="token string">'7'</span><span class="token punctuation">,</span><span class="token string">'8'</span><span class="token punctuation">,</span><span class="token string">'9'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> mbus_regi<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token string">':'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'.'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">,</span><span class="token string">'R'</span><span class="token punctuation">,</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token string">'T'</span><span class="token punctuation">,</span><span class="token string">':'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'.'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> RH_Data<span class="token punctuation">;</span><span class="token comment">//定义湿度值，起到中转作用,因为其数值一般大于255，所以声明为int 类型</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> T_Data<span class="token punctuation">;</span><span class="token comment">//定义温度值，起到中转作用 ,因为其数值一般大于255，所以声明为int 类型</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span>  Sys_CNT<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span>  Tmp<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">Send_Warning_Msg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 温度过高发送警告短信</span>

bit		B_TI<span class="token punctuation">;</span>
sbit Sensor_SDA <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//定义P1.1为AM2321的数据口</span>

<span class="token comment">/********************函数声明区**************************************/</span>
<span class="token keyword">void</span> <span class="token function">uart1_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//声明串口初始化函数</span>
<span class="token keyword">void</span> <span class="token function">Uart1_TxByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> dat<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//声明串口发送单字节函数</span>
<span class="token keyword">void</span> <span class="token function">Uart1_String</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> code <span class="token operator">*</span>puts<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//声明串口发送字符串函数</span>
<span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> ms<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//声明普通延时函数</span>
<span class="token keyword">void</span> <span class="token function">Clear_Data</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//声明AM2321的数据清除函数</span>
<span class="token keyword">void</span> <span class="token function">delay_3ms</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//声明延时3ms函数</span>
<span class="token keyword">void</span> <span class="token function">delay_30us</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//声明延时30us函数</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">Read_SensorData</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//声明读取AM2321数据函数</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">Read_Sensor</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//声明读取AM2321温湿度数据函数</span>
<span class="token comment">/**********************************************************/</span>

<span class="token comment">/*****用户定义参数 ，声明串口参数为9600 8 N 1  ***********/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">MAIN_Fosc		<span class="token number">11059200UL</span>	</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">Baudrate0		<span class="token number">9600UL</span>											</span></span>
<span class="token comment">/**********************************************************/</span>


<span class="token comment">/****************** 编译器自动生成，用户请勿修改 ***********************/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">BRT_Reload</span>			<span class="token punctuation">(</span><span class="token number">256</span> <span class="token operator">-</span> MAIN_Fosc <span class="token operator">/</span> <span class="token number">16</span> <span class="token operator">/</span> Baudrate0<span class="token punctuation">)</span></span></span>

<span class="token comment">/**********************************************************/</span>


<span class="token comment">//**********************************************************************</span>
<span class="token comment">//函数名：main(void)</span>
<span class="token comment">//输入  ：无</span>
<span class="token comment">//输出  ：无</span>
<span class="token comment">//功能描述：实现STC12C5A16S2单片机的P1.1口读取AM2321的温湿度数据，并按照</span>
<span class="token comment">//          ASCII格式输出到串口界面中</span>
<span class="token comment">//          按照&quot;H:xx.x%RH,T:xx.x”格式每隔约2秒显示一次。</span>
<span class="token comment">//*************************************************************************</span>
<span class="token keyword">void</span>	<span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Sensor_SDA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//SDA数据线由上拉电阻拉高一直保持高电平，初始化数据总线。</span>
	<span class="token function">uart1_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//初始化串口，参数为9600 8 N 1.</span>
	<span class="token function">Uart1_String</span><span class="token punctuation">(</span><span class="token string">&quot;www.frotech.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//串口打印输出测试字符串。</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//死循环开始</span>
	<span class="token punctuation">{</span>
	  
		<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//延时</span>
	    <span class="token function">Read_Sensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		  <span class="token comment">// 读取传感器数据</span>
	
		<span class="token keyword">if</span><span class="token punctuation">(</span>Sensor_Data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">(</span>Sensor_Data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span> Sensor_Data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>Sensor_Data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">+</span>Sensor_Data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//判断温湿度校验值是否相等，见AM2321数据手册P17.</span>
		<span class="token punctuation">{</span>
		  RH_Data <span class="token operator">=</span> <span class="token punctuation">(</span>Sensor_Data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">)</span> <span class="token operator">+</span> Sensor_Data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//保存湿度值，见AM2321数据手册P17</span>
		  T_Data  <span class="token operator">=</span> <span class="token punctuation">(</span>Sensor_Data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">)</span> <span class="token operator">+</span> Sensor_Data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//保存温度值，见AM2321数据手册P17</span>

		  mbus_regi<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>	<span class="token operator">=</span> Ascii_buffer<span class="token punctuation">[</span>RH_Data<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//取得湿度十位值</span>
		  mbus_regi<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>	<span class="token operator">=</span> Ascii_buffer<span class="token punctuation">[</span><span class="token punctuation">(</span>RH_Data<span class="token operator">%</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//取得湿度个位值</span>
		  mbus_regi<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>	<span class="token operator">=</span> Ascii_buffer<span class="token punctuation">[</span>RH_Data<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//取得湿度小数值</span>

		  mbus_regi<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span>	<span class="token operator">=</span> Ascii_buffer<span class="token punctuation">[</span>T_Data<span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//取得温度十位值</span>
		  mbus_regi<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span>	<span class="token operator">=</span> Ascii_buffer<span class="token punctuation">[</span><span class="token punctuation">(</span>T_Data<span class="token operator">%</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//取得温度个位值</span>
		  mbus_regi<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span>	<span class="token operator">=</span> Ascii_buffer<span class="token punctuation">[</span>T_Data<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//取得温度小数值</span>

		  <span class="token comment">//for(i = 0; i &lt; 16; i++)</span>
		  <span class="token comment">//{</span>
		      <span class="token comment">//Uart1_TxByte(mbus_regi[i]);//按照&quot;H:xx.x%RH,T:xx.x”格式发送温湿度值</span>
			  <span class="token comment">//Uart1_String(&quot;www.frotech.com&quot;); //串口打印输出测试字符串。</span>
		  <span class="token comment">//}</span>

		  <span class="token keyword">if</span><span class="token punctuation">(</span>T_Data <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		  	<span class="token comment">//Uart1_String(&quot;www.frotech.com&quot;); //串口打印输出测试字符串。</span>
			<span class="token function">Uart1_String</span><span class="token punctuation">(</span><span class="token string">&quot;ATD13409679886;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">Uart1_TxByte</span><span class="token punctuation">(</span><span class="token string">&quot;\r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">Uart1_TxByte</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//Send_Warning_Msg();</span>
		  <span class="token punctuation">}</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//void Send_Warning_Msg(){</span>
	<span class="token comment">// 需要用到 4G 短信模块</span>
	<span class="token comment">//Uart1_String(&quot;ATD13409679886;&quot;);</span>
	<span class="token comment">//Uart1_TxByte(&quot;\r&quot;);</span>
	<span class="token comment">//Uart1_TxByte(&quot;\n&quot;);</span>
<span class="token comment">//}</span>

<span class="token keyword">void</span>	<span class="token function">uart1_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	PCON <span class="token operator">|=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>		<span class="token comment">//UART0 Double Rate Enable</span>
	SCON <span class="token operator">=</span> <span class="token number">0x50</span><span class="token punctuation">;</span>		<span class="token comment">//UART0 set as 10bit , UART0 RX enable</span>
	AUXR <span class="token operator">|=</span>  <span class="token number">0x01</span><span class="token punctuation">;</span>		<span class="token comment">//UART0 使用BRT</span>
	AUXR <span class="token operator">|=</span>  <span class="token number">0x04</span><span class="token punctuation">;</span>		<span class="token comment">//BRT set as 1T mode</span>
	BRT <span class="token operator">=</span> BRT_Reload<span class="token punctuation">;</span>
	AUXR <span class="token operator">|=</span>  <span class="token number">0x10</span><span class="token punctuation">;</span>		<span class="token comment">//start BRT	</span>

	ES  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Uart1_TxByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> dat<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    B_TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	SBUF <span class="token operator">=</span> dat<span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>B_TI<span class="token punctuation">)</span><span class="token punctuation">;</span>
	B_TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Uart1_String</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> code <span class="token operator">*</span>puts<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token operator">*</span>puts <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span> puts<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
        <span class="token function">Uart1_TxByte</span><span class="token punctuation">(</span><span class="token operator">*</span>puts<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/**********************************************/</span>
<span class="token keyword">void</span> <span class="token function">UART1_RCV</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">4</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>RI<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		RX0_Buffer<span class="token punctuation">[</span>uart1_wr<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> SBUF<span class="token punctuation">;</span>
		<span class="token comment">//if(++uart0_wr &gt;= BUF_LENTH)	uart0_wr = 0;</span>
		flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>TI<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		B_TI <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//**********************************************************************</span>
<span class="token comment">//函数名：delay_3ms(void)</span>
<span class="token comment">//输入  ：无</span>
<span class="token comment">//输出  ：无</span>
<span class="token comment">//功能描述：延时3ms函数</span>
<span class="token comment">//*************************************************************************</span>
<span class="token keyword">void</span> <span class="token function">delay_3ms</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>   
<span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> a<span class="token punctuation">,</span>b<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>b<span class="token operator">=</span><span class="token number">194</span><span class="token punctuation">;</span>b<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>b<span class="token operator">--</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">84</span><span class="token punctuation">;</span>a<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>a<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//**********************************************************************</span>
<span class="token comment">//函数名：delay_30us(void)</span>
<span class="token comment">//输入  ：无</span>
<span class="token comment">//输出  ：无</span>
<span class="token comment">//功能描述：延时3ms函数</span>
<span class="token comment">//*************************************************************************</span>
<span class="token keyword">void</span> <span class="token function">delay_30us</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>   
<span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> a<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">164</span><span class="token punctuation">;</span>a<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>a<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> ms<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
	<span class="token keyword">do</span><span class="token punctuation">{</span>
	    i <span class="token operator">=</span> MAIN_Fosc <span class="token operator">/</span><span class="token number">1400</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//**********************************************************************</span>
<span class="token comment">//函数名：Read_SensorData(void)</span>
<span class="token comment">//输入  ：无</span>
<span class="token comment">//输出  ：单字节的温湿度数据或者校验值</span>
<span class="token comment">//功能描述：读取单字节的AM2321的数据</span>
<span class="token comment">//*************************************************************************</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">Read_SensorData</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span>cnt<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> buffer<span class="token punctuation">,</span>tmp<span class="token punctuation">;</span>
	buffer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>Sensor_SDA<span class="token punctuation">)</span>	<span class="token comment">//检测上次低电平是否结束</span>
		<span class="token punctuation">{</span>
		  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>cnt <span class="token operator">&gt;=</span> <span class="token number">290</span><span class="token punctuation">)</span>
		   <span class="token punctuation">{</span>
			  <span class="token keyword">break</span><span class="token punctuation">;</span>
		   <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//延时Min=26us Max50us 跳过数据&quot;0&quot; 的高电平</span>
		<span class="token function">delay_30us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时30us </span>
		tmp <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>Sensor_SDA<span class="token punctuation">)</span><span class="token comment">//延时30us后如果数据口还是高，则该位为1，否则为0，见P19	 </span>
		<span class="token punctuation">{</span>
		  tmp <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>  
		cnt <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span>Sensor_SDA<span class="token punctuation">)</span>		<span class="token comment">//等待高电平 结束</span>
		<span class="token punctuation">{</span>
		   	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>cnt <span class="token operator">&gt;=</span> <span class="token number">200</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
			  <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		buffer <span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//移位，使得数据的最低位准备接收下一位</span>
		buffer <span class="token operator">|=</span> tmp<span class="token punctuation">;</span><span class="token comment">//把本次接收到的位加入到数据中	</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> buffer<span class="token punctuation">;</span><span class="token comment">//返回单字节数据</span>
  <span class="token punctuation">}</span>

<span class="token comment">//**********************************************************************</span>
<span class="token comment">//函数名：Read_Sensor(void)</span>
<span class="token comment">//输入  ：无</span>
<span class="token comment">//输出  ：无</span>
<span class="token comment">//功能描述：读取AM2321的温湿度及校验值放在Sensor_Data[]中。</span>
<span class="token comment">//*************************************************************************</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">Read_Sensor</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>

    Sensor_SDA <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//起始信号拉低，见AM2321数据手册P18</span>
	<span class="token function">delay_3ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//延时3Ms，当然一般1ms就可以了。</span>
	Sensor_SDA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//拉高，释放总线</span>
	<span class="token function">delay_30us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//延时30us</span>
	Sensor_AnswerFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 传感器响应标志	 </span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Sensor_SDA <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//从高电平到低电平经过30us(大于20us)是否为低</span>
	<span class="token punctuation">{</span>  
	   <span class="token comment">//如果为低，那么传感器发出响应信号</span>
	   Sensor_AnswerFlag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//收到起始信号</span>
	   Sys_CNT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//判断从机是否发出 80us 的低电平响应信号是否结束	 </span>
	   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>Sensor_SDA<span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">//等待传感器响应信号80us的低电平结束</span>
	   <span class="token punctuation">{</span>
	     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>Sys_CNT<span class="token operator">&gt;</span><span class="token number">300</span><span class="token punctuation">)</span> <span class="token comment">//防止进入死循环</span>
		 <span class="token punctuation">{</span>
		   Sensor_ErrorFlag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
		  <span class="token punctuation">}</span> 
	    <span class="token punctuation">}</span>
	    Sys_CNT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	    <span class="token comment">//判断从机是否发出 80us 的高电平，如发出则进入数据接收状态</span>
	    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Sensor_SDA<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//等待传感器响应信号80us的高电平结束</span>
	    <span class="token punctuation">{</span>
	       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>Sys_CNT<span class="token operator">&gt;</span><span class="token number">300</span><span class="token punctuation">)</span> <span class="token comment">//防止进入死循环</span>
		   <span class="token punctuation">{</span>
		     Sensor_ErrorFlag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
		   <span class="token punctuation">}</span> 
	    <span class="token punctuation">}</span> 		 
	    <span class="token comment">// 数据接收	传感器共发送40位数据 </span>
	    <span class="token comment">// 即5个字节 高位先送  5个字节分别为湿度高位 湿度低位 温度高位 温度低位 校验和</span>
	    <span class="token comment">// 校验和为：湿度高位+湿度低位+温度高位+温度低位</span>
	    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	    <span class="token punctuation">{</span>
	      Sensor_Data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Read_SensorData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	   
	  <span class="token punctuation">}</span>
	  <span class="token keyword">else</span>
	  <span class="token punctuation">{</span>
	    Sensor_AnswerFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	  <span class="token comment">// 未收到传感器响应	</span>
	  <span class="token punctuation">}</span>
	  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>    



</code></pre></div><h3 id="温度传感器"><a href="#温度传感器" class="header-anchor">#</a> 温度传感器</h3> <h3 id="短信通知"><a href="#短信通知" class="header-anchor">#</a> 短信通知</h3> <p>我们做的实验用的 串口助手 发送的消息，没代码啊。</p> <h2 id="蓝牙"><a href="#蓝牙" class="header-anchor">#</a> 蓝牙</h2> <p>可以去做 实验8  基于BLE协议栈的串口透传实验.doc 实验，然后可以选择题目 4、5 和 书上的实验。实验 8 为基础。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/DayoWong0/Note/edit/master/cs/大三上/物联网通信技术.md" target="_blank" rel="noopener noreferrer"> Edit on Github </a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/21/2020, 2:38:16 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ⟵
      <a href="/Note/cs/大三上/工程概论习题和答案.html" class="prev">
        工程概论习题和答案
      </a></span> <span class="next"><a href="/Note/cs/desktop/Electron/electron.html">
        Electron
      </a>
      ⟶
    </span></p></div> </main></div><div class="global-ui"><div style="visibility:hidden;display:none;"></div><!----></div></div>
    <script src="/Note/assets/js/app.3401943d.js" defer></script><script src="/Note/assets/js/4.23a40e1e.js" defer></script><script src="/Note/assets/js/26.bee200f9.js" defer></script><script src="/Note/assets/js/27.fe55bec1.js" defer></script>
  </body>
</html>
